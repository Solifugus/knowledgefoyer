# Knowledge Foyer Production Environment Configuration
# Copy this file to .env.production and customize values for your production environment

# =============================================================================
# ENVIRONMENT
# =============================================================================
NODE_ENV=production
PORT=3000
WS_PORT=3001

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
# Production PostgreSQL connection
DATABASE_URL=postgresql://username:password@localhost:5432/knowledge_foyer_prod

# Connection Pool Settings (Production Optimized)
DB_POOL_MAX=25
DB_POOL_MIN=2
DB_CONNECTION_TIMEOUT=10000
DB_IDLE_TIMEOUT=30000
DB_ACQUIRE_TIMEOUT=60000
DB_QUERY_TIMEOUT=30000
DB_STATEMENT_TIMEOUT=60000

# Database Logging (Disable in production for performance)
DB_LOG_ALL_QUERIES=false
DB_LOG_CONNECTIONS=false

# Slow Query Threshold (milliseconds)
SLOW_QUERY_THRESHOLD=1000

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
# Production Redis connection
REDIS_URL=redis://localhost:6379
REDIS_TTL_DEFAULT=300
REDIS_PASSWORD=your-redis-password

# =============================================================================
# AUTHENTICATION & SECURITY
# =============================================================================
# Strong JWT secret for production (generate with: openssl rand -hex 64)
JWT_SECRET=your-super-secure-jwt-secret-key-at-least-64-characters-long

# Session configuration
JWT_EXPIRY=24h
JWT_REFRESH_EXPIRY=7d

# Password hashing (bcrypt rounds - 12 is good for production)
BCRYPT_ROUNDS=12

# Rate limiting
RATE_LIMIT_WINDOW=900000  # 15 minutes in milliseconds
RATE_LIMIT_MAX=100        # Max requests per window

# =============================================================================
# SSL/TLS CONFIGURATION
# =============================================================================
# SSL Certificate paths (for HTTPS)
SSL_CERT_PATH=/path/to/ssl/certificate.crt
SSL_KEY_PATH=/path/to/ssl/private.key
SSL_CA_PATH=/path/to/ssl/ca-bundle.crt

# Force HTTPS redirect
FORCE_HTTPS=true

# =============================================================================
# EMAIL CONFIGURATION
# =============================================================================
# Production SMTP settings
SMTP_HOST=smtp.your-email-provider.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=noreply@yourdomain.com
SMTP_PASS=your-smtp-password
EMAIL_FROM=noreply@yourdomain.com

# Email verification settings
EMAIL_VERIFICATION_EXPIRY=24h
EMAIL_VERIFICATION_URL=https://yourdomain.com/verify-email

# =============================================================================
# OPENAI INTEGRATION
# =============================================================================
# OpenAI API configuration
OPENAI_API_KEY=your-openai-api-key
OPENAI_EMBEDDING_MODEL=text-embedding-ada-002
OPENAI_COMPLETION_MODEL=gpt-4-turbo-preview

# Cost controls (USD)
OPENAI_DAILY_BUDGET_LIMIT=10.00
OPENAI_COST_PER_1K_TOKENS_EMBEDDING=0.0001
OPENAI_COST_PER_1K_TOKENS_COMPLETION_INPUT=0.01
OPENAI_COST_PER_1K_TOKENS_COMPLETION_OUTPUT=0.03

# =============================================================================
# MONITORING & LOGGING
# =============================================================================
# Logging configuration
LOG_LEVEL=info
LOG_FORMAT=json
LOG_FILE_PATH=/var/log/knowledge-foyer/app.log
LOG_ERROR_FILE_PATH=/var/log/knowledge-foyer/error.log
LOG_MAX_SIZE=10m
LOG_MAX_FILES=5

# Application monitoring
MONITORING_ENABLED=true
HEALTH_CHECK_ENDPOINT=/health

# Performance thresholds
RESPONSE_TIME_THRESHOLD=1000
ERROR_RATE_THRESHOLD=0.05
MEMORY_USAGE_THRESHOLD=0.8
CPU_USAGE_THRESHOLD=0.8
CACHE_HIT_RATE_THRESHOLD=0.7

# =============================================================================
# SECURITY HEADERS & CORS
# =============================================================================
# CORS configuration
CORS_ORIGIN=https://yourdomain.com
CORS_CREDENTIALS=true

# Security headers
HELMET_CSP_ENABLED=true
HELMET_HSTS_ENABLED=true
HELMET_NOSNIFF_ENABLED=true

# =============================================================================
# SUBDOMAIN CONFIGURATION
# =============================================================================
# User subdomain settings
USER_SUBDOMAIN_ENABLED=true
BASE_DOMAIN=yourdomain.com
SUBDOMAIN_WILDCARD=*.yourdomain.com

# =============================================================================
# FILE UPLOAD & STORAGE
# =============================================================================
# File upload limits
MAX_FILE_SIZE=5242880  # 5MB in bytes
ALLOWED_FILE_TYPES=jpg,jpeg,png,gif,pdf

# Storage configuration (if using cloud storage)
STORAGE_PROVIDER=local  # local, s3, gcp, azure
AWS_S3_BUCKET=your-s3-bucket
AWS_S3_REGION=us-east-1
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key

# =============================================================================
# SEARCH CONFIGURATION
# =============================================================================
# Search optimization
SEARCH_MIN_RELEVANCE=0.1
SEARCH_MAX_RESULTS=100

# =============================================================================
# CACHING CONFIGURATION
# =============================================================================
# Cache TTL settings (seconds)
CACHE_TTL_ARTICLES=300
CACHE_TTL_USERS=600
CACHE_TTL_FEEDS=60
CACHE_TTL_SEARCH=300
CACHE_TTL_STATS=120

# =============================================================================
# PROCESS MANAGEMENT
# =============================================================================
# PM2 configuration
PM2_INSTANCES=max
PM2_EXEC_MODE=cluster
PM2_MAX_MEMORY_RESTART=1G

# Worker process settings
CLUSTER_WORKERS=0  # 0 = auto detect CPU cores

# =============================================================================
# BACKUP & MAINTENANCE
# =============================================================================
# Database backup settings
BACKUP_ENABLED=true
BACKUP_INTERVAL=daily
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=your-backup-bucket

# Maintenance windows
MAINTENANCE_WINDOW_START=02:00
MAINTENANCE_WINDOW_END=04:00
MAINTENANCE_TIMEZONE=UTC

# =============================================================================
# EXTERNAL INTEGRATIONS
# =============================================================================
# Analytics
GOOGLE_ANALYTICS_ID=UA-XXXXXXXXX-X
MIXPANEL_TOKEN=your-mixpanel-token

# Error tracking
SENTRY_DSN=https://your-sentry-dsn
SENTRY_ENVIRONMENT=production

# =============================================================================
# FEATURE FLAGS
# =============================================================================
# Feature toggles
FEATURE_AI_FEEDBACK=true
FEATURE_REALTIME_UPDATES=true
FEATURE_EXPOSITIONS=true
FEATURE_SOCIAL_FEATURES=true
FEATURE_EMAIL_NOTIFICATIONS=true

# =============================================================================
# LEGAL & COMPLIANCE
# =============================================================================
# Terms of service and privacy policy URLs
TERMS_OF_SERVICE_URL=https://yourdomain.com/terms
PRIVACY_POLICY_URL=https://yourdomain.com/privacy
GDPR_COMPLIANCE=true

# Data retention policies (days)
USER_DATA_RETENTION_DAYS=2555  # ~7 years
INACTIVE_ACCOUNT_DELETION_DAYS=1095  # 3 years
LOG_RETENTION_DAYS=90

# =============================================================================
# DEVELOPMENT & DEBUGGING (Disable in production)
# =============================================================================
# Debug settings (NEVER enable in production)
DEBUG_MODE=false
VERBOSE_LOGGING=false
ENABLE_PLAYGROUND=false
EXPOSE_STACK_TRACES=false

# Performance profiling (only enable for debugging production issues)
ENABLE_PROFILING=false
PROFILING_SAMPLE_RATE=0.01

# =============================================================================
# HEALTH CHECKS & MONITORING
# =============================================================================
# Health check configuration
HEALTH_CHECK_TIMEOUT=5000
HEALTH_CHECK_INTERVAL=30000

# External monitoring
MONITORING_WEBHOOK_URL=https://your-monitoring-service.com/webhook
ALERT_EMAIL=admin@yourdomain.com
ALERT_SLACK_WEBHOOK=https://hooks.slack.com/your-webhook

# =============================================================================
# CUSTOM DOMAIN CONFIGURATION
# =============================================================================
# Custom domain support for user profiles
CUSTOM_DOMAINS_ENABLED=false
DNS_VERIFICATION_ENABLED=false

# =============================================================================
# API RATE LIMITING
# =============================================================================
# API-specific rate limits
API_RATE_LIMIT_WINDOW=3600000  # 1 hour
API_RATE_LIMIT_MAX=1000        # Max API calls per hour
API_BURST_LIMIT=100            # Burst limit

# =============================================================================
# WEBSOCKET CONFIGURATION
# =============================================================================
# WebSocket settings
WS_MAX_CONNECTIONS=1000
WS_HEARTBEAT_INTERVAL=30000
WS_CONNECTION_TIMEOUT=5000
WS_MESSAGE_SIZE_LIMIT=1048576  # 1MB